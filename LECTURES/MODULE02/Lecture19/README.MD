OTUS 20210430

# EIGRP #

![](pictures/01.jpg)

Усовершенствованный IGRP. Рекомендуется для работы в средних сетях (диаметр сети - 255 переходов, лучше до 100). Проприетарный. После 2013 года - уже слился и стал свободным, но не все вендоры совместимы по EIGRP. Tcnm ghtbveotcndf^
- сходимость
- ресурсоемкость

![](pictures/02.jpg)

DV - протоколы на слухах, что за соседом - понятия не имеем. Ориентируемся на показания соседей.

EIGRP использует RTP протокол, обеспечивающий гарантированную доставку EIGRP сообщений поверх 3-го уровня, не привязан ни к TCP, ни к UDP

EIGRP позволяет исопльзовать несколько маршрутов с разной метрикой (при включении доп. настроек).

Feasible Successor - возможный приемник, на случай потери основного маршрута

![](pictures/03.jpg)

EIGRP проприетарный до 2013 года и работал поверх всего устаревшего барахла.

Для каждого линкА EIGRP строит свои базы данных

![](pictures/04.jpg)

Все данные, кроме Hello поддерживают подтверждение получения пакета

![](pictures/05.jpg)

АУ/АВ позволяет безопасно использовать данные протокола передаваемые по сети. Но это не обеспечивает шифрование трафика

![](pictures/06.jpg)

Сначала EIGRP называли гибридным протоколом. Ошибка на слайде EIGRP v4 использует адрес 255.0.0.10; v6 - АА02::A

![](pictures/07.jpg)

5 типов пакетов, используемых для обмена:
- Hello - всегда ненадежно, по непассивным IF (каждые 5 секунд), поэтому в другие подсети - IF надо гасить. Принятый пакет от соседа дальше не пошлется. TTL = 1
- Update - объявление об изменении топологии, идет отправка только изменений в таблице маршрутизации
- Ack - подтверждение
- Request (делается на предмет выявления маршрутов к имеющимся на нем сетям)
- Reply (ответ на запрос) - в этом проблма TS: 
   - появляются таймеры на предмет выяснения маршрутов у соседей
   - не отвечает сосед => R1 не ответит R2
   - возможно сохранится маршрут в подсеть, которая уже не доступна через соседа


![](pictures/08.jpg)

![](pictures/09.jpg)

## Сообщения EIGRP ##

![](pictures/10.jpg)

![](pictures/11.jpg)


## Настройка EIGRP для IPv4##

Речь идет о "Автономной системе", аналог зоны OSPF, должен совпадает для всех R в одной зоне. Не надо настраиватьна R несколько экземпляров на роутере
![](pictures/12.jpg)

![](pictures/13.jpg)

![](pictures/14.jpg)

RID - униакльное 32-битное значение, или лучше взять Lo

![](pictures/15.jpg)

![](pictures/16.jpg)

![](pictures/17.jpg)

Сеть объявляется:
- командой Network без маски
- Шаблонной маской

![](pictures/18.jpg)
Сначала рекмоендуется заглушить/passive интерфейс default, затем объявить IF no passive


## Проверка работы ##

![](pictures/19.jpg)

```Sho ip eigrp nei``` - таблица соседних устройств

![](pictures/20.jpg)

EIGRP можетт суммировать маршруты (п.п.4) с классовой маской при дополнительном включении этого параметра

variance - коэффициент который связывает/добавляет маршрут другой стоимости в таблицу маршрутизации

![](pictures/21.jpg)

## Принципы работы ##

После того как соседские отношения подняты, соседи попадают в таблицу соседей.

![](pictures/22.jpg)

![](pictures/23.jpg)

Информация обо всех сетях попадает в таблицу топологии.

![](pictures/24.jpg)

![](pictures/25.jpg)

Метрика выяисляется по страшной формуле:
- от BW
- от задержек (совокупная задержка по пути)

![](pictures/26.jpg)

![](pictures/27.jpg)

BW можно менять, чтобы влиять на расчет стоимости пути, но его неудобно использовать, когда через физический IF еще идет какой-то туннель.

![](pictures/28.jpg)

![](pictures/29.jpg)

![](pictures/30.jpg)

Метрика для v6 EIGRP - дает возможность работать с IF больше 10 Гбит.

### Алгоритм DUAL ###

![](pictures/31.jpg)

![](pictures/32.jpg)

Расчет идет на основании информации от соседей 
- сначала имеется информция до соседа (RD - reported distance, раньше называлась AD)
- потом прибавляется стоимость до сети, полученная от соседа
- затем сравниваются все маршруты и 
- маршрут с минимальной стоимостью попадет в таблицу маршрутизации, как маршрут от Successor (по-умолчанию маршрутов с одинаковой стоимостью в таблице маршрутизации может быть до 4)
- также выяисняем альтернативные маршруты, с большей стоимостью (даже если их будет несколько) и такие маршруты добавляем в таблицу топологий, как маршрут от Feasible Successor

![](pictures/33.jpg)

![](pictures/34.jpg)

![](pictures/35.jpg)

![](pictures/36.jpg)

![](pictures/37.jpg)

![](pictures/38.jpg)

![](pictures/39.jpg)

![](pictures/40.jpg)

Там, где нет FS, происходит поиск альтернативного маршрута. Если P/Passive - все хорошо.

![](pictures/41.jpg)

![](pictures/42.jpg)

![](pictures/43.jpg)

